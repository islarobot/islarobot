<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Basic Actuators</title>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script> 
        <script type="text/javascript" src="assets/classes.js"></script>
        <!--The above library(/socket.io/socket.io.js) will be generated by socket.io module of server -->
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script> 
        <link rel="stylesheet" href="assets/main.css">
        <script>
         var socket = io.connect("/"); 
			var values_items = []


			
			 for (var i = 0;i<8;i++) {
			 	
			 	values_items.push({min:0, max:255, param:"",state:"set",id:i})
			 }       
        
			
       
        
        
			function get_id_from_param(param_input,vl_array){
			
			 for (var i = 0;i<8;i++) {
			
			if (vl_array[i].param == param_input) {
				
				return vl_array[i].id
				
			}			
			
			}
			return -1
			}

			function hide_fields_show_values(id,vl)
			{
			document.getElementById("min"+id).style.display='none';
			document.getElementById("max"+id).style.display='none';
			document.getElementById("param"+id).style.display='none';
			document.getElementById("setvalues_button"+id).innerText="Reset";		
			
			  document.getElementById('minlabel'+id).innerHTML = vl.min;
			  document.getElementById('maxlabel'+id).innerHTML = vl.max;
			  document.getElementById('paramlabel'+id).innerHTML = vl.param;
			  


			}
			
			function show_fields_hide_values(id,vl)
			{
			document.getElementById("min"+id).style.display='initial';
			document.getElementById("max"+id).style.display='initial';
			document.getElementById("param"+id).style.display='initial';
			document.getElementById("setvalues_button"+id).innerText="Set Values";		
			
			  document.getElementById('minlabel'+id).innerHTML = '';
			  document.getElementById('maxlabel'+id).innerHTML = '';
			  document.getElementById('paramlabel'+id).innerHTML = '';
			  
			  document.getElementById('min'+id).value = vl.min;
			  document.getElementById('max'+id).value = vl.max;
			  document.getElementById('param'+id).value = vl.param;


			}
        
			function press_button(id,vl){
			
			if (vl.state == "set") {
							
			var min_local = document.getElementById("min"+id).value;
						
			vl.min = min_local		
			var max_local = document.getElementById("max"+id).value;
			vl.max = max_local	
			var param_local = document.getElementById("param"+id).value;
			vl.param = param_local	
			
			hide_fields_show_values(id,vl)
			vl.state = "reset";
			document.getElementById("myRange"+id).min = min_local;
			document.getElementById("myRange"+id).max = max_local;
			
			}else {
				
			show_fields_hide_values(id,vl);	
			vl.state = "set";
				
			}
			}      
			
			function progress_changevalue(a){
			
						var val1 = document.getElementById("myRange"+a).value;
						document.getElementById("content"+a).innerHTML = val1;

						var info_tuple =
						{
						param:values_items[a].param,
						value_info:val1						
						}

				socket.emit('send_info',info_tuple);
				
						
			}						  
        
        </script>
    </head>
    
        <style>
    
    	
    
    </style>
    
    
    <body>
    
   <table border="1" width = "100%" height = "500">
		<tr>
		<td>
		
		<table border="1" width = "100%" height = "100%">
		<tr>
		<td>  
		
		<button onclick="press_button(0,values_items[0])" id="setvalues_button0">Set values</button>
		
		Min Value:&nbsp;<label id="minlabel0"></label><input type="text" id="min0" size="3">
		Max Value:&nbsp;<label id="maxlabel0"></label><input type="text" id="max0" size="3">
		Parameter code:&nbsp;<label id="paramlabel0"></label><input type="text" id="param0" size="3"> 
		
		</td>
		<td>
		
		</td>				
		</tr>
		
		<tr>
		<td>
		<div id="content0"></div>
		<input class="classInputProgress" type="range" id="myRange0" value="0" oninput="progress_changevalue(0)">

				
		</td>
		<td>4</td>				
		</tr>
		
		
		</table>
		
		
		</td>
		<td>
		
		<table border="1" width = "100%" height = "100%">
		<tr>
		<td>  
		
		<button onclick="press_button(1,values_items[1])" id="setvalues_button1">Set values</button>
		
		Min Value:&nbsp;<label id="minlabel1"></label><input type="text" id="min1" size="3">
		Max Value:&nbsp;<label id="maxlabel1"></label><input type="text" id="max1" size="3">
		Parameter code:&nbsp;<label id="paramlabel1"></label><input type="text" id="param1" size="3"> 
		
		</td>
		<td>
		
		</td>				
		</tr>
		
		<tr>
		<td>
		<div id="content1"></div>
				<input class="classInputProgress" type="range" id="myRange1" value="0" oninput="progress_changevalue(1)">
				
		</td>
		<td>4</td>				
		</tr>
		
		
		</table>
				
		
		</td>				
		</tr>
		<tr>
		<td>3</td>
		<td>4</td>				
		</tr>
		<tr>
		<td>5</td>
		<td>6</td>				
		</tr>
		<tr>
		<td>7</td>
		<td>8</td>				
		</tr>
   
   
   
   </table>

    </body>
    
	<script type="text/javascript">
	
		function move_progessbar(id,val) {
    				var elem = document.getElementById(id); 
			    	elem.style.width = val + 'px'; 
        		
    			}         
        
        
            var socket = io.connect("/"); 
            /*Initializing the connection with the server via websockets */
            
				//recibo mensajes del servidor!!!            
            socket.on("stream",function(message){  
               


                message = JSON.parse(message);
					
					
					//get id
					idparam = get_id_from_param(message.param,values_items)   
					
					if (idparam != -1) {
					
					//console.log(message1); /*converting the data into JS object */
                //$('#content').append('<div >'+message.value_number+'</div>'); /*appending the data on the page using Jquery */
                document.getElementById("content"+idparam).innerHTML = message.value_number;
                move_progessbar('bar'+idparam,message.value_number,values_items[idparam].min, values_items[idparam].max);
						
					}             
                
                
  


            });
            
            $(function(){
                $('#submit').click(function(){ /*listening to the button click using Jquery listener*/

                    //var message_local = new classes.message_object('c6_clienteweb','c4_ardu','0','hola, ardu, soy clienteweb');
                    var message_local = {
 							origin:"c6_clienteweb",
 							destination:"c4_ardu",
 							type:"0",
 							value_text:"hola ardu, soy clienteweb"
                    }
                    socket.send(JSON.stringify(message_local));

 
                    $('#message').val('');
                    //Emptying the text box value using jquery 
 
                });
            });
 
 
				function move_progessbar(id,val,min,max) {
    				var elem = document.getElementById(id); 
    				var output_value = (val-min) * (100) / (max - min)
			    	elem.style.width = output_value + '%'; 
        		
    			} 	
	
	</script>    
    
</html>
